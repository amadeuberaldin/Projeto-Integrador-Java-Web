<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Painel - Minha Despensa</title>
        <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
        <link rel="stylesheet" th:href="@{/estilo.css}">
        <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.js"></script>
        <script th:src="@{/Script.js}"></script>
        <meta name="_csrf" th:content="${_csrf.token}">
        <meta name="_csrf_header" th:content="${_csrf.headerName}">
    </head>
    <body>
        <h1>Bem-vindo(a) à sua Despensa!</h1>

        <div class="container">
            <!-- Primeira linha: Produtos -->
            <div class="row">
                <div class="col">
                    <h2>Cadastrar Produto</h2>
                    <form th:action="@{/produtos/salvar}" th:object="${produto}" method="post">
                        <label for="nomeProduto">Nome do Produto:</label>
                        <input type="text" id="nomeProduto" th:field="*{nome}" required><br>

                        <label for="porcao">Porção de Referência:</label>
                        <input type="number" id="porcao" th:field="*{porcaoReferencia}" required><br>

                        <label for="proteinas">Proteínas:</label>
                        <input type="number" id="proteinas" th:field="*{proteinas}" required><br>

                        <label for="carboidratos">Carboidratos:</label>
                        <input type="number" id="carboidratos" th:field="*{carboidratos}" required><br>

                        <label for="calorias">Calorias:</label>
                        <input type="number" id="calorias" th:field="*{calorias}" required><br>

                        <label for="gorduras">Gorduras Totais:</label>
                        <input type="number" id="gorduras" th:field="*{gordurasTotais}" required><br>

                        <button type="submit">Cadastrar Produto</button>
                    </form>
                </div>

                <!-- Lista de Produtos (Coluna 2) -->
                <div class="col">
                    <h2>Lista de Produtos</h2>
                    <div style="max-height: 450px; overflow-y: auto;">
                        <table>
                            <tbody>
                                <tr th:each="produto : ${produtos}" th:onclick="|showProduto(${produto.id})|" style="cursor: pointer;">
                                    <td th:text="${produto.nome}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Detalhes do Produto Selecionado (Coluna 3) -->
                <div class="col col-produto-info">
                    <h2>Informações do Produto</h2>
                    <div id="produto-detalhes"></div>
                </div>
            </div>
            <!-- Div para o pop-up de edição -->
            <div id="edit-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border: 1px solid #ccc; z-index: 1000;">
                <h3>Editar Produto</h3>
                <form id="edit-form">
                    <label for="edit-nome">Nome:</label>
                    <input type="text" id="edit-nome" required><br>

                    <label for="edit-porcao">Porção de Referência:</label>
                    <input type="number" id="edit-porcao" required><br>

                    <label for="edit-proteinas">Proteínas:</label>
                    <input type="number" id="edit-proteinas" required><br>

                    <label for="edit-carboidratos">Carboidratos:</label>
                    <input type="number" id="edit-carboidratos" required><br>

                    <label for="edit-calorias">Calorias:</label>
                    <input type="number" id="edit-calorias" required><br>

                    <label for="edit-gorduras">Gorduras Totais:</label>
                    <input type="number" id="edit-gorduras" required><br>

                    <button type="button" onclick="saveEdits()">Salvar Alterações</button>
                    <button type="button" onclick="closeEditPopup()">Cancelar</button>
                </form>
            </div>
            <!-- Segunda linha: Receitas -->
            <div class="row">
                <div class="col">
                    <h2>Cadastrar Receita</h2>
                    <form th:action="@{/receitas/salvar}" th:object="${receita}" method="post">
                        <label for="nomeReceita">Nome da Receita:</label>
                        <input type="text" id="nomeReceita" th:field="*{nome}" required><br>

                        <!-- Campos para adicionar ingredientes -->
                        <div th:each="produto : ${produtos}">
                            <label th:for="'produto' + ${produto.id}" th:text="${produto.nome}"></label>
                            <input type="number" th:name="ingredientes[__${produto.id}__]" placeholder="Quantidade" th:attr="id='produto' + ${produto.id}"><br>
                        </div>

                        <label for="modoPreparo">Modo de Preparo:</label>
                        <textarea id="modoPreparo" th:field="*{modoPreparo}" required></textarea><br>

                        <button type="submit">Cadastrar Receita</button>
                    </form>
                </div>

                <!-- Lista de Receitas (Coluna 2) -->
                <div class="col">
                    <h2>Lista de Receitas</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="receita : ${receitas}" onclick="showReceita([[${receita.id}]])" style="cursor: pointer;">
                                <td th:text="${receita.nome}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Detalhes da Receita Selecionada (Coluna 3) -->
                <div class="col col-receita-info">
                    <h2>Informações da Receita</h2>
                    <!-- Detalhes da receita serão carregados aqui -->
                    <div id="receita-detalhes"></div>
                </div>
            </div>
        </div>
    </body>
</html>
